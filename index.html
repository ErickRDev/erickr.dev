<html>
    <header>
        <link rel="stylesheet" href="layouts.css">
        <link rel="stylesheet" href="styles.css">

        <script src="https://unpkg.com/vue@next"></script>
        <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>
    </header>
    <body>
        <div id="app">
            <navbar></navbar>
            <div id="app-content" class="stack">
                <img id="avatar-pic" src="assets/imgs/no.jpg">
                <terminal></terminal>
                <div id="canvas"></div>
            </div>
        </div>
    </body>
    <script>
        let FEEDBACKS = [
            '(╯°□°）╯︵ ┻━┻'
        ];

        const app = Vue.createApp({});

        app.component('navbar', {
            template: `
            <div id="navbar">
                <ul id="navbar-content">
                    <li>
                        <a id="navbar-title" href="#index.html">ERICKR.DEV</a>
                    </li>
                    <li>
                        <div id="navbar-locales-menu">
                            <button id="locale-en" class="locale-button">EN</button>
                            <button id="locale-pt" class="locale-button">PT</button>
                            <button id="locale-fr" class="locale-button">FR</button>
                        </div>
                    </li>
                </ul>
            </div>
            `
        })

        app.component('terminal', {
            template: `
            <div id="terminal">
                <div id="terminal-top-bar">
                    <button @click="collapsed = !collapsed">-</button>
                </div>
                <div id="terminal-content" v-if="!collapsed">
                    <div id="stdout-content" class="stack stack-stdout" v-if="mode === 'stdout'" @click="focusInput">
                        <p v-for="line in stdout">
                            {{line}}
                        </p>
                        {{cmdPrefix}}<input id="cmd" autofocus v-model="cmd" @keyup.enter="executeCommand"/>
                    </div>
                    <gui v-if="mode === 'gui'" :quit="this.quitCli"></gui>
                </div>
            </div>
            `,
            data() {
                return {
                    mode: 'stdout',
                    cmdPrefix: '$ ',
                    cmd: null,
                    collapsed: false,
                    stdout: [],
                    feedbacksIndex: 0
                }
            },
            mounted() {
                let typed = new Typed('#cmd', {
                    strings: [ 'echo $ABOUT_ME' ],
                    typeSpeed: 20,
                    showCursor: true,
                    onComplete: (self) => {
                        this.cmd = 'echo $ABOUT_ME';
                        document.getElementById("cmd").dispatchEvent (new KeyboardEvent ('keyup', {
                            key: 'enter',
                            keyCode: 13
                        }));
                    }
                })
            },
            methods: {
                focusInput() {
                    document.getElementById("cmd").focus();
                },
                executeCommand() {
                    console.log("Executing command: " + this.cmd);

                    this.stdout.push(this.cmdPrefix + this.cmd);

                    switch (this.cmd) {
                        case 'echo $ABOUT_ME':
                            this.stdout.push('Howdie! Welcome to my little corner on the internet! My name is Erick, I\'m a computer scientist who loves everything-software!');
                            break;
                        case 'whoami':
                            this.stdout.push('Erick Rocha');
                            break;
                        case 'ls':
                            break;
                        case 'clear':
                            this.stdout.length = 0;
                            break;
                        case '?':
                            break;
                        case '.':
                            this.mode = 'gui';
                            break;
                        default:
                            this.stdout.push(FEEDBACKS[this.feedbacksIndex % FEEDBACKS.length]);
                            this.feedbacksIndex += 1;
                            break;
                    }

                    this.cmd = '';
                },
                quitCli() {
                    this.mode = 'stdout';
                    console.log("quitting CLI mode");
                }
            }

        })

        app.component('gui', {
            template: `
            <div id="gui" class="stack">
                <div id="gui-title-bar">
                    <h1>ABOUT ME</h1>
                </div>
                <div id="gui-content">
                    <ul class="stack stack-gui-menu-items" v-if="selected === 'projects'">
                        <li>
                            <a @click="selected = 'pomodoro'">POMODORO CLI</a>
                        </li>
                        <li>
                            <a @click="selected = null">BACK</a>
                        </li>
                    </ul>
                    <ul class="stack stack-gui-menu-items" v-else>
                        <li>
                            <a @click="selected = 'xp'">PROFESSIONAL EXPERIENCE</a>
                        </li>
                        <li>
                            <a @click="selected = 'projects'">PROJECTS</a>
                        </li>
                        <li>
                            <a @click="selected = null">RESET</a>
                        </li>
                        <li>
                            <a @click="quit">EXIT</a>
                        </li>
                    </ul>
                </div>
                <teleport to="#canvas">
                    <transition name="pomodoro-animation">
                        <h1 id="pomodoro-title" v-if="selected === 'pomodoro'">POMODORO</h1>
                    </transition>
                    <projects-pomodoro v-bind:show="selected === 'pomodoro'"></projects-pomodoro>
                </teleport>
            </div>
            `,
            props: [ "quit" ],
            data() {
                return {
                    selected: null,
                }
            }
        })

        app.component('projects-pomodoro', {
            template: `
            <div v-if="show">
                <p>POMODORO LOGO GOES HERE</p>
                <a href="https://github.com/ErickRDev/rusty-tomato">Repository</a>
                <p>Ipsum dolor..</p>
            </div>
            `,
            props: [ "show" ]
        })

        const vm = app.mount("#app");

    </script>
</html>